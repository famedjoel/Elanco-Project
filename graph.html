<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get and Display JSON data with Chart.js</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <h1>Users:</h1>
    <ul></ul>

    <!-- Add a canvas element for the chart -->
    <canvas id="myChart" width="400" height="200"></canvas>

    <script>
        const applications = [
            "Macao", "Delaware-deposit-Plastic", "index-Consultant-blue", "Integrated-SDD", "Accountability-Clothing",
            "Philippines-THX", "info-mediaries", "AI-Administrator-capability", "firewall-Towels-compressing"
            // "Officer", "Triple-buffered-Brand", "program-compelling", "Corporate-Electronics", "Multi-tiered",
            // "global-Rustic", "Cambridgeshire-next-Springs", "Bike-Hawaii-Naira", "Health", "seamless-Arkansas-payment",
            // "Markets-payment-Shoes", "Solutions", "Industrial", "Locks-integrated", "EXE", "redundant-copy-action-items",
            // "Regional-Table", "Licensed-Account-paradigms", "auxiliary-Granite", "calculating", "zero", "markets-reboot-Avon",
            // "Account-Pizza-cross-media", "Computers", "Granite", "Computers-Fresh", "User-centric",
            // "Palau-redundant-solution-oriented", "Dakota-Future-proofed-SCSI", "Maine-Avon", "Loti", "Wooden-Health",
            // "Table-Flats-Electronics", "Territory-e-markets", "forecast-Games", "Gloves", "red-Facilitator", "1080p-Lock",
            // "mobile-transmit", "interface-deliver"
        ];

        // Fetch and display data for each application
        applications.forEach(application => {
            fetchData(`https://engineering-task.elancoapps.com/api/applications/${application}`, application);
        });

        async function fetchData(url, label) {
            try {
                const response = await fetch(url);
                const data = await response.json();

                console.log(data); // Log the data to inspect its structure

                // Extract data for the chart (modify this based on your data structure)
                const labels = data.map(entry => entry.Date);
                const costs = data.map(entry => parseFloat(entry.Cost));

                // Get the existing chart or create a new one
                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = ctx.chart;

                // Check if the chart already exists
                if (myChart) {
                    // Add a new dataset for each application
                    myChart.data.datasets.push({
                        label: label,
                        data: costs,
                        fill: false,
                        borderColor: getRandomColor(),
                        borderWidth: 1
                    });

                    // Update the chart
                    myChart.update();
                } else {
                    // Create a line chart using Chart.js
                    const newChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: label,
                                data: costs,
                                fill: false,
                                borderColor: getRandomColor(),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    type: 'category',
                                    labels: labels,
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Date'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    max: 25, // Set the maximum value for the Y-axis
                                    title: {
                                        display: true,
                                        text: 'Cost'
                                    }
                                }
                            }
                        }
                    });

                    // Save the created chart to the canvas
                    ctx.chart = newChart;
                }

            } catch (error) {
                console.error('Error fetching data:', error);
                // You can display an error message to the user if needed
            }
        }

        // Function to generate a random color
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>

</body>
</html>
